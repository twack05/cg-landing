<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Join Cater Greater and Learn the Strategies Top Caterers Use in Their Businesses</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/creative.min.css" rel="stylesheet">

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-106739387-1', 'auto');
      ga('send', 'pageview');
    
    </script>

    <style>
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
        }
      </style>

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="index.html"><img src="img/cg-logo.png" style="height: 40px; width: 120px;" /></a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#call-to-action">Special Offer!</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- <header class="masthead">
      <div class="header-content">
        <div class="header-content-inner">
            <iframe width="560" height="315" src="https://www.youtube.com/embed/665ODhUiomE?rel=0&amp;controls=0&amp;showinfo=0&autoplay=1" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
    </header> -->

    <div id="call-to-action" class="call-to-action">
      <div class="container">
        <h2 class="text-center">Ready to take your Catering Business to the Next Level?</h2>
        <ul>
          <li class="mt-3">Introducing Cater Greater - a community where you can learn business strategies and tactics from top caterers!</li>
          
          <li class="mt-3">Cater Greater is full of hours of video tutorials offering step-by-step strategies you can use to improve your catering business</li>
          
          <li class="mt-3">New tutorials are added all the time based on input from the community</li>
          
          <li class="mt-3">Membership is normally $50/month and offers hundreds, <i>if not thousands</i>, of dollars worth of value in <strong>increased sales</strong>, <strong>saved time</strong>, and <strong>new business channels</strong></li>
          
          <li class="mt-3">Right now, we're offering a limited number of spots at a discounted rate of <strong>only $20 a month</strong> for the lifetime of your membership. <span class="text-primary"><em>That's 60% off!</em></span></li>         
        </ul>
        <div class="text-center">
          <h3 class="text-danger"><del>Normally $50 a month</del></h3>
          <h2>Only $20 a month!</h2>
          <h4 id="count">10 memberships left</h4>
          <a id="join" class="btn btn-primary btn-xl sr-button" href="#">Join Now</a>
        </div>
      </div>
    </div>

    <div class="modal" id="join-modal">
        <div class="modal-content container text-center">
            <span class="close" style="text-align: right;" >&times;</span>
            <div style="margin-right: 25%; margin-left: 25%">
              <img src="img/cg-logo.png" style="width: 50%; height: 80px;" />
            </div>
            <h2>Membership</h2>
            <form style="margin-bottom: 20px;">
                <label>First Name</label><br/>
                <input type="text" id="first" /><br/>
                <label>Last Name</label><br/>
                <input type="text" id="last" /><br/>
                <label>Email</label><br/>
                <input type="email" id="email"/><br/>
                <label>Biggest challenge you currently face in your catering business?</label><br/>
                <input type="text" id="challenge" /><br/>
            </form>
            <div class='errors'></div>
            <a id="submit" class="btn btn-primary btn-xl" style="margin-left: 35%; margin-right: 35%" href="#">Submit</a>
        </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper/popper.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/scrollreveal/scrollreveal.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/creative.min.js"></script>

    <script>
      $(document).ready(() => {
        const dev = 'http://localhost:3000';
        const prod = 'http://cater-greater-api.herokuapp.com';
        const API_URL = prod;
        let modal = document.getElementById('join-modal');
        let count = 10;

        modal.style.display = "none";

        if (localStorage.getItem('joined') === "true") {
          joinSuccess();
        } else {
          setTimeout(changeCount, 3000);
          setInterval(changeCount, 12000);
        }

        $('#join').on('click', (e) => {
          e.preventDefault();
          modal.style.display = "block";
          if (localStorage.getItem('first')) {
            $('#first').val(localStorage.getItem('first'));
          }
          if (localStorage.getItem('email')) {
            $('#email').val(localStorage.getItem('email'));
          }
          if (localStorage.getItem('challenge')) {
            $('#challenge').val(localStorage.getItem('challenge'));
          }
        })

        function changeCount() {
          if (count > 2) {
            count = count - getRandomInt(1, 3);
            count === 0 ? count = 1 : count = count;
            count === 1 ? $('#count').text(`${count} membership left`) : $('#count').text(`${count} memberships left`);
            if (localStorage.getItem('joined') === "true") {
              $('#count').html(`<h4 class="text-danger">0 memberships left</h4>`);
            }
          }
        }

        function getRandomInt(min, max) {
          min = Math.ceil(min);
          max = Math.floor(max);
          return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
        }

        $('#submit').on('click', (e) => {
          e.preventDefault();
          $('.errors').empty();
          let errors = validateFields();

          if (errors.length > 0) {
              errors.map((error) => {
                  $('.errors').append(`<p class="text-danger">${error}</p>`);
              })
              return;
          }

          createUser();
        });

        function validateFields() {
          let first = $('#first').val();
          let last = $('#last').val();
          let email = $('#email').val();
          let challenge = $('#challenge').val();
          let errors = [];

          let firstIsValid = validateFirst(first);
          let lastIsValid = validateFirst(last);
          let emailIsValid = validateEmail(email);
          let challengeIsValid = validateChallenge(challenge);

          if (!firstIsValid) {
              errors.push("A valid first name is required.");
          }

          if (!lastIsValid) {
              errors.push("A valid last name is required.");
          }

          if (!emailIsValid) {
              errors.push("A valid email is required.");
          }

          if (!challengeIsValid) {
              errors.push("Biggest challenge is required.");
          }

          return errors;

          function validateFirst(first) {
              let letters = /^[A-Za-z]+$/;
              return letters.test(first);
          }

          function validateEmail(email) {
              let re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              return re.test(email);
          }

          function validateChallenge(challenge) {
              return challenge.length > 3;
          }
        }

        function createUser() {
            let first = $('#first').val();
            let last = $('#last').val();
            let email = $('#email').val();
            let challenge = $('#challenge').val();
            let user = { user:
                            {
                                first: first,
                                last: last,
                                email: email,
                                challenge: challenge,
                                stage: 'Join completed',
                                active: true,
                                rate: 20
                            }
                        };
          $.ajax({
            url: `${API_URL}/users/${localStorage.getItem('id')}`,
            type: 'PUT',
            data: user,
            success: joinSuccess
          });
        }

        function joinSuccess(result) {
          if (!localStorage.getItem('joined') === "true") {
            localStorage.setItem('first', result.first);
          }
          localStorage.setItem('joined', true);
          $('form').empty();
          $('.close').empty();
          $('#submit').remove();
          $('form').html(`<p>Thank you for signing up, ${localStorage.getItem('first')}!</p><p>Unfortunately, all of our membership spots have been filled at this time.</p><p>We will email you as soon as another spot becomes available.</p>`)
          $('.errors').append(`<a class="btn btn-primary btn-xl" href="index.html">Return Home</a>`)
          changeCount();
        }

        window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
        }

        $('.close').on('click', () => {
          modal.style.display = "none";
        });
      })
    </script>

  </body>

</html>
